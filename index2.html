<html>
<head>
<title>Artist Clusters</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="d3-tip.js"></script>
<script src="js/d3tip.js"></script>


<link rel = "stylesheet" type = "text/css" href = "styles/style.css" />
</head>
<body>


<style>
.d3-tip {
  line-height: 1;
  font-weight: light;
  padding: 12px;
  background: #e6e6e6;
  color: black;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

</style>

<!-- End Tool Tip stuff -->






<div id="container">

	<h1>One-Hit Wonders</h1>

	<svg></svg>

	<br><br><br>

	<select name="decades" id="decades" value="Sixties"
	oninput="showCircles(this.value)"
	onchange="showCircles(this.value)">
    	<option value="Sixties">1960s</option>
    	<option value="Seventies">1970s</option>
    	<option value="Eighties">1980s</option>
    	<option value="Nineties">1990s</option>
    	<option value="Two_Thousands">2000s</option>
    	<option value="Twenty_Tens">2010s</option>
  	</select>

</div>


<script>


	var artistValues;

	var radiusSize = 5;

	var decade = document.getElementById("decades").value;

	var numsixties = 0;
	var numseventies = 0;
	var numeighties = 0;
	var numnineties = 0; 
	var numtwotousands = 0;
	var numtwentytens = 0;


	function mutateRow(row) {

		row["Artist"] = row["Artist"];

		row["Sixties"] = Number(row["Sixties"]);
		if (row["Sixties"] > 0){
			numsixties++;
		}
		row["Seventies"] = Number(row["Seventies"]);
		if (row["Seventies"] > 0){
			numseventies++;
		}
		row["Eighties"] = Number(row["Eighties"]);
		if (row["Eighties"] > 0){
			numeighties++;
		}
		row["Nineties"] = Number(row["Nineties"]);
		if (row["Nineties"] > 0){
			numnineties++;
		}
		row["Two_Thousands"] = Number(row["Two_Thousands"]);
		if (row["Two_Thousands"] > 0){
			numtwotousands++;
		}
		row["Twenty_Tens"] = Number(row["Twenty_Tens"]);
		if (row["Twenty_Tens"] > 0){
			numtwentytens++;
		}

		row["Gender"] = row["Gender"];

		//console.log(numsixties);

		return row;

	}

	function callback(error, data){
		//console.log("data")
		//console.log(data);

		artistValues = data.map(function(d){
			return {
				Artist: d.Artist,
				Sixties: d.Sixties,
				Seventies: d.Seventies,
				Eighties: d.Eighties,
				Nineties: d.Nineties,
				Two_Thousands: d.Two_Thousands,
				Twenty_Tens: d.Twenty_Tens,
				Gender: d.Gender
			};
		});

		// console.log("artists")
		// console.log(artistValues);
		showCircles(decade);
	}


	function showCircles(decade){

		d3.selectAll("circle").remove();
		d3.selectAll("text").remove();

		var height = 500;
		var width = 900;
		var padding = 10;

		var extent = 50

		var xScale = d3.scaleLinear().domain([-extent, extent]).range([0, width]);
		var yScale = d3.scaleLinear().domain([-extent, extent]).range([height, 0]);
		var rScale = d3.scaleSqrt().domain([0, 10]).range([0, 15]);
		var fillScale = d3.scaleLinear().domain([-extent, 0, extent]).range(['#fc8d59','#ffffbf','#91bfdb'])

		var gaussian = d3.randomNormal();
		var logNormal = function () { return Math.exp(gaussian() + 1.0); }

		var lazyGaussian = function (list) {
		  // Sample MORE than the current length of the list
		  var j = Math.floor( Math.random() * (list.length + 1) ); 
		  if (list.length == 0 || j >= list.length) {
		    // If we picked the last index, sample a new value
		    return gaussian();
		  }
		  else {
		    // Otherwise copy the previous existing value
		    return list[j].a;
		  }
		}


		var svg = d3.select("svg").attr("height", height).attr("width", width);


		var tip = d3.tip()
		      .attr("class", "d3-tip")
		      .offset([-8, 0])
		      .html(function(d) { return d; });
		    svg.call(tip);

		// not using this nodes array
		var nodes = [];
		var numstop;

		if(decade == "Sixties"){
			numstop = numsixties;
		}
		if(decade=="Seventies"){
			numstop = numseventies;
		}
		if (decade=="Eighties"){
			numstop = numeighties;
		}
		if (decade=="Nineties"){
			numstop = numnineties;
		}
		if (decade == "Two_Thousands"){
			numstop = numtwotousands;
		}
		if (decade=="Twenty_Tens"){
			numstop =numtwentytens;
		}


		for (var i = 0; i < numstop; i++) {
		  nodes.push({
		    "id": i,
		    "a": gaussian(),
		    "b": logNormal()
		  });
		}

		var simulation = d3.forceSimulation();

		simulation
			.force("x", d3.forceX(d => xScale(d[decade])).strength(.1))
			.force("y", d3.forceY(yScale(.3)))
			.force("collision", d3.forceCollide(d=> rScale(d[decade]*3)))
			.force("center", d3.forceCenter(400,250));		// tells you the position of the center of the cluster?

		simulation
			.nodes(artistValues)
			.on("tick", updateDisplay);
			// console.log(nodes);

			// Create circles for nodes.
			// radius is num of hits in decade
			// color is gender
			// purple is multiple/band/unknown
			// pink is female
			// blue male 


			var circles = svg.selectAll("circle")
				.data(artistValues).enter()
				.filter(function (d) {return d[decade] > 0; })
				.append("circle")
				.attr("r", function (d) { return rScale(d[decade]*2); })
				.attr("class", "artistCircle")
				.style("fill", function(d){
					if(d.Gender == "male"){
						// console.log(d.Gender)
						return "#399FF9";
						//return fillScale("#399FF9");
					} else if (d.Gender == "female"){
						return "#FFC0CB";
						//return fillScale("#F955F2");
					} else {
						return "#800080";
					}

				})
				.style("opacity", 0.95)
				.on('mouseover', tip.show)
      			.on('mouseout', tip.hide);
				// .on("mouseover", function(d) {		
		  //           tip.transition()		
		  //               .duration(200)		
		  //               .style("opacity", .9);
		  //           // position the tool tip in the right location
		  //           tip.html(d)  
	  	// 				.style("left", d3.select(this).attr("cx") + "px")     
	  	// 				.style("top", d3.select(this).attr("cy") + "px");		
		  //           })					
		  //       .on("mouseout", function(d) {		
		  //           tip.transition()		
		  //               .duration(500)		
		  //               .style("opacity", 0);	
	   //      	});

			//Move the circles to their locations.
			updateDisplay();

			function updateDisplay() {
			  circles
			  //.data(nodes)
			  .attr("cx", function(d) { return d.x; })
			  .attr("cy", function(d) { return d.y; });
			}


		//click/drag functions from https://bl.ocks.org/mbostock/2675ff61ea5e063ede2b5d63c08020c7! and professor Mimno!
		circles
		.call(d3.drag()
		.on("start", dragstarted)
		.on("drag", dragged)
		.on("end", dragended));

		function dragstarted(d) {
			if (!d3.event.active) { simulation.alphaTarget(0.3) };
		  	d.fx = d.x;
		  	d.fy = d.y;
		}

		function dragged(d) {
		  	d.fx = d3.event.x;
		  	d.fy = d3.event.y;
		}

		function dragended(d) {
		  	if (!d3.event.active) { simulation.alphaTarget(0.0) };
		  	d.fx = null;
		  	d.fy = null;
		}

	}

	d3.csv("artist_song_counts1.csv", mutateRow, callback);

</script>

</body>
</html>